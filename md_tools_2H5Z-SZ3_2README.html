<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FZ Module Library: H5Z-SZ3 Filter Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FZ Module Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">H5Z-SZ3 Filter Integration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> The H5Z-SZ3 filter integrates the <a class="el" href="namespaceSZ3.html">SZ3</a> compression library with HDF5, providing an efficient way to compress and decompress data within HDF5 files.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ul>
<li>Installation</li>
<li>H5Z-SZ3 cd_values</li>
<li>Usage<ul>
<li>HDF5 Executables</li>
<li>Python (h5py)</li>
<li>C/C++</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Step 1: Build and Install SZ3</h2>
<p>Compile and install <a class="el" href="namespaceSZ3.html">SZ3</a> with the H5Z-SZ3 filter enabled: </p><div class="fragment"><div class="line">Add -DBUILD_H5Z_FILTER=true to the CMake command to enable H5Z-SZ3 filter in SZ3</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Step 2: Configure Environment</h2>
<p>Add the directory containing the H5Z-SZ3 library (<code>libhdf5sz3.so</code> or <code>libhdf5sz3.dylib</code>) to your <code>HDF5_PLUGIN_PATH</code> and <code>LD_LIBRARY_PATH</code> environment variables: </p><div class="fragment"><div class="line">export HDF5_PLUGIN_PATH=${HDF5_PLUGIN_PATH}:&lt;PATH_TO_YOUR_H5Z-SZ3_LIB&gt;/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
H5Z-SZ3 cd_values</h1>
<ul>
<li>HDF5 restricts the parameters that can be passed to filters through an integers array called <code>cd_values</code>.</li>
<li>H5Z-SZ3 uses <code>cd_values</code> to pass the desired compression settings (e.g., algorithm, error bounds) to the compression process. It serializes the <code>Config</code> object to <code>cd_values</code> using the <code>save()</code> function.</li>
<li>During decompression, H5Z-SZ3 does not rely on <code>cd_values</code>. Instead, it reads all the configuration directly from the compressed data.</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
HDF5 Executables</h2>
<p>Note: if the HDF5 in your system contains both <code>h5repack-shared</code> and <code>h5repack</code>, you need to use <code>h5repack-shared</code> for filters, as outlined in <a href="https://github.com/LLNL/H5Z-ZFP/issues/137">H5Z-ZFP Issue #137</a>.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Compression</h3>
<p><b>Method 1: Compression with default settings (see <a class="el" href="Config_8hpp.html" title="This file defines the configuration class and related utilities for SZ3.">SZ3/utils/Config.hpp</a> for defaults)</b> </p><div class="fragment"><div class="line">h5repack-shared -f UD=32024,0 data.h5 data.sz3.h5</div>
</div><!-- fragment --><p><b>Method 2: Compression with customized settings in configuration file</b></p>
<p>Step 1: Generate H5Z-SZ3 cd_values from <a class="el" href="namespaceSZ3.html">SZ3</a> configuration file: </p><div class="fragment"><div class="line">cdvalueHelper -c sz3.config</div>
</div><!-- fragment --><p> Step 2: Compress by h5repack-shared with generated cd_values: </p><div class="fragment"><div class="line">h5repack-shared -f UD=[put cd_values here] data.h5 data.sz3.h5</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Decompression</h3>
<div class="fragment"><div class="line">h5repack-shared -f NONE data.sz3.h5 data.sz3_decompressed.h5</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Python (h5py)</h2>
<p>To use H5Z-SZ3 with h5py in Python:</p>
<ol type="1">
<li>Ensure h5py is linked against the same HDF5 library used to build the <a class="el" href="namespaceSZ3.html">SZ3</a> filter (typically system HDF5).</li>
<li>Set <code>HDF5_PLUGIN_PATH</code> to the directory containing <code>libhdf5sz3.so</code> or <code>libhdf5sz3.dylib</code> <b>before importing h5py</b>.</li>
<li>Use h5py's compression interface with <a class="el" href="namespaceSZ3.html">SZ3</a> filter ID 32024 and appropriate compression options.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">import</span> os</div>
<div class="line">os.environ[<span class="stringliteral">&quot;HDF5_PLUGIN_PATH&quot;</span>] = <span class="stringliteral">&quot;/path/to/h5z-sz3/lib&quot;</span></div>
<div class="line"><span class="keyword">import</span> h5py</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"> </div>
<div class="line"><span class="keyword">from</span> cdvalueHelper <span class="keyword">import</span> SZ3</div>
<div class="line">config = <a class="code hl_namespace" href="namespaceSZ3.html">SZ3</a>(<span class="stringliteral">&#39;ALGO_INTERP_LORENZO&#39;</span>, absolute=1e-3)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">with</span> h5py.File(<span class="stringliteral">&#39;data.h5&#39;</span>, <span class="stringliteral">&#39;w&#39;</span>) <span class="keyword">as</span> f:</div>
<div class="line">    f.create_dataset(<span class="stringliteral">&#39;dataset&#39;</span>, data=np.random.rand(100, 100), </div>
<div class="line">                     compression=32024, compression_opts=tuple(config.cd_values))</div>
<div class="ttc" id="anamespaceSZ3_html"><div class="ttname"><a href="namespaceSZ3.html">SZ3</a></div><div class="ttdef"><b>Definition</b> SZAlgoBioMD.hpp:16</div></div>
</div><!-- fragment --><p><b>Note on HDF5 Runtime Compatibility</b>: If h5py was installed with its bundled HDF5 (common on macOS), it may not load plugins built against system HDF5 due to library conflicts. To resolve:</p><ul>
<li>Rebuild h5py against system HDF5: <code>export HDF5_DIR=/path/to/system/hdf5 &amp;&amp; pip install --force-reinstall --no-binary h5py h5py</code></li>
<li>Ensure HDF5 versions match between h5py and the plugin.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
C/C++</h2>
<p>See examples <code>sz3ToHDF5.cpp</code> and <code>dsz3FromHDF5.cpp</code> for how to use the H5Z-SZ3 filter in your C/C++ projects. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
